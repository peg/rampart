# Rampart Policy — OpenClaw Example
# Tuned for securing an OpenClaw agent.
# Customize to your needs, then: rampart serve --config openclaw.yaml

version: "1"
default_action: allow

policies:
  # ── Credential Protection ──────────────────────────────────────
  - name: protect-credentials
    priority: 1
    match:
      tool: ["read"]
    rules:
      - action: deny
        when:
          path_matches:
            - "**/.ssh/id_*"
            - "**/.aws/credentials"
            - "**/.gnupg/*"
            - "**/*.pem"
            - "**/*.key"
            - "**/.env"
            - "**/.env.*"
            - "**/.netrc"
            - "**/.git-credentials"
        message: "Credential file access blocked"

  # ── Identity Protection ────────────────────────────────────────
  - name: protect-identity
    match:
      tool: ["write"]
    rules:
      - action: deny
        when:
          path_matches:
            - "**/SOUL.md"
            - "**/AGENTS.md"
            - "**/.openclaw/*"
        message: "Agent cannot modify its own identity files"

  # ── Command Execution Safety ───────────────────────────────────
  - name: exec-safety
    match:
      tool: "exec"
    rules:
      - action: deny
        when:
          command_matches:
            - "rm -rf /"
            - "rm -rf ~"
            - "rm -rf /*"
            - "rm -rf ~/*"
            - ":(){ :|:& };:"
            - "mkfs.*"
            - "dd if=/dev/zero*"
            - "chmod -R 777 /"
            - "curl * | sh"
            - "curl * | bash"
            - "wget * | sh"
            - "wget * | bash"
        message: "Destructive command pattern blocked"

  # ── Credential Exfiltration via Shell ────────────────────────────
  - name: block-credential-exfil
    priority: 1
    match:
      tool: "exec"
    rules:
      - action: deny
        when:
          command_matches:
            - "cat ~/.ssh/*"
            - "cat ~/.aws/*"
            - "cat ~/.env*"
            - "cat ~/.netrc*"
            - "cat ~/.git-credentials*"
            - "cat /etc/shadow*"
            - "sudo cat /etc/shadow*"
            - "base64 ~/.ssh/*"
            - "base64 ~/.aws/*"
            - "*cat*.ssh*|*curl*"
            - "*cat*.ssh*|*wget*"
            - "*cat*.aws*|*curl*"
            - "*curl*$(cat*"
            - "*wget*$(cat*"
        message: "Credential access or exfiltration blocked"

  # ── Encoding/Obfuscation Detection ────────────────────────────
  # Catches AI agents trying to encode data before exfiltrating.
  # Threat model: hallucinating/manipulated agents, not adversarial humans.
  - name: block-encoding-exfil
    priority: 1
    match:
      tool: "exec"
    rules:
      - action: deny
        when:
          command_matches:
            # Piping sensitive files through encoding
            - "*cat*.ssh*|*base64*"
            - "*cat*.aws*|*base64*"
            - "*cat*.env*|*base64*"
            - "*cat*.gnupg*|*base64*"
            - "*cat*/etc/shadow*|*base64*"
            # base64 piped to network tools
            - "*base64*|*curl*"
            - "*base64*|*wget*"
            - "*base64*|*nc *"
            - "*base64*|*ncat*"
            - "*base64*|*netcat*"
            # xxd/hex encoding of secrets
            - "*xxd*.ssh*"
            - "*xxd*.aws*"
            - "*xxd*/etc/shadow*"
            - "*xxd*|*curl*"
            - "*xxd*|*wget*"
            # openssl encoding
            - "*openssl*enc*-base64*-in*"
            - "*openssl*enc*-in*.ssh*"
            - "*openssl*enc*-in*.aws*"
            # Python one-liners (common AI agent pattern)
            - "*python*base64*encode*.ssh*"
            - "*python*base64*encode*.aws*"
            - "*python*base64*encode*.env*"
            - "*python*open(*.ssh*"
            - "*python*open(*.aws*"
            - "*python*open(*/etc/shadow*"
            # Perl encoding
            - "*perl*MIME::Base64*.ssh*"
            - "*perl*MIME::Base64*.aws*"
            # eval with encoded payloads
            - "*eval*$(echo*|*base64*"
            - "*echo*|*base64*-d*|*sh*"
            - "*echo*|*base64*-d*|*bash*"
            # Reverse shell patterns (bonus)
            - "*bash -i >& /dev/tcp*"
            - "*python*socket*connect*"
            - "*nc -e /bin/*"
            - "*ncat -e /bin/*"
        message: "Encoding/obfuscation of sensitive data blocked"

  # ── Known Exfiltration Domains ─────────────────────────────────
  - name: block-exfil-domains
    priority: 1
    match:
      tool: "exec"
    rules:
      - action: deny
        when:
          command_matches:
            - "*curl*webhook.site*"
            - "*curl*ngrok.io*"
            - "*curl*ngrok-free.app*"
            - "*curl*requestbin.com*"
            - "*curl*pipedream.net*"
            - "*curl*beeceptor.com*"
            - "*wget*webhook.site*"
            - "*wget*ngrok.io*"
            - "*wget*requestbin.com*"
        message: "Data exfiltration to known staging domain blocked"

  - name: log-privileged
    match:
      tool: "exec"
    rules:
      - action: log
        when:
          command_matches:
            - "sudo *"
            - "systemctl *"
            - "docker rm *"
            - "docker stop *"
            - "kubectl delete *"
            - "kubectl apply *"
        message: "Privileged command logged for review"

  - name: log-network
    match:
      tool: "exec"
    rules:
      - action: log
        when:
          command_matches:
            - "curl *"
            - "wget *"
            - "scp *"
            - "rsync *"
        message: "Network command logged"
