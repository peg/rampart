# Rampart Policy — OpenClaw Example
# Tuned for securing an OpenClaw agent.
# Customize to your needs, then: rampart serve --config openclaw.yaml

version: "1"
default_action: allow

policies:
  # ── Credential Protection ──────────────────────────────────────
  - name: protect-credentials
    priority: 1
    match:
      tool: ["read"]
    rules:
      - action: deny
        when:
          path_matches:
            - "**/.ssh/id_*"
            - "**/.aws/credentials"
            - "**/.gnupg/*"
            - "**/*.pem"
            - "**/*.key"
            - "**/.env"
            - "**/.env.*"
            - "**/.netrc"
            - "**/.git-credentials"
        message: "Credential file access blocked"

  # ── Identity Protection ────────────────────────────────────────
  - name: protect-identity
    match:
      tool: ["write"]
    rules:
      - action: deny
        when:
          path_matches:
            - "**/SOUL.md"
            - "**/AGENTS.md"
            - "**/.openclaw/*"
        message: "Agent cannot modify its own identity files"

  # ── Command Execution Safety ───────────────────────────────────
  - name: exec-safety
    match:
      tool: "exec"
    rules:
      - action: deny
        when:
          command_matches:
            - "rm -rf /"
            - "rm -rf ~"
            - "rm -rf /*"
            - "rm -rf ~/*"
            - ":(){ :|:& };:"
            - "mkfs.*"
            - "dd if=/dev/zero*"
            - "chmod -R 777 /"
            - "curl * | sh"
            - "curl * | bash"
            - "wget * | sh"
            - "wget * | bash"
        message: "Destructive command pattern blocked"

  # ── Credential Exfiltration via Shell ────────────────────────────
  - name: block-credential-exfil
    priority: 1
    match:
      tool: "exec"
    rules:
      - action: deny
        when:
          command_matches:
            - "cat ~/.ssh/*"
            - "cat ~/.aws/*"
            - "cat ~/.env*"
            - "cat ~/.netrc*"
            - "cat ~/.git-credentials*"
            - "cat /etc/shadow*"
            - "sudo cat /etc/shadow*"
            - "base64 ~/.ssh/*"
            - "base64 ~/.aws/*"
            - "*cat*.ssh*|*curl*"
            - "*cat*.ssh*|*wget*"
            - "*cat*.aws*|*curl*"
            - "*curl*$(cat*"
            - "*wget*$(cat*"
        message: "Credential access or exfiltration blocked"

  # ── Known Exfiltration Domains ─────────────────────────────────
  - name: block-exfil-domains
    priority: 1
    match:
      tool: "exec"
    rules:
      - action: deny
        when:
          command_matches:
            - "*curl*webhook.site*"
            - "*curl*ngrok.io*"
            - "*curl*ngrok-free.app*"
            - "*curl*requestbin.com*"
            - "*curl*pipedream.net*"
            - "*curl*beeceptor.com*"
            - "*wget*webhook.site*"
            - "*wget*ngrok.io*"
            - "*wget*requestbin.com*"
        message: "Data exfiltration to known staging domain blocked"

  - name: log-privileged
    match:
      tool: "exec"
    rules:
      - action: log
        when:
          command_matches:
            - "sudo *"
            - "systemctl *"
            - "docker rm *"
            - "docker stop *"
            - "kubectl delete *"
            - "kubectl apply *"
        message: "Privileged command logged for review"

  - name: log-network
    match:
      tool: "exec"
    rules:
      - action: log
        when:
          command_matches:
            - "curl *"
            - "wget *"
            - "scp *"
            - "rsync *"
        message: "Network command logged"
